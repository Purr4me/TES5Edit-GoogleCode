#summary How to post to the USEPWiki

http://www.uesp.net/wiki/Tes5Mod:Mod_File_Format

= The USEPWiki =

Those updating the wiki can navagate to this page and click on one of the records.  

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki1.jpg

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki2.jpg

For this example I'm going to use MISC since it isn't really formated properly and contains the same information you will recieve in a ticket from one of the decoders. To get started click the edit tab.

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki3.jpg

For what our project is doing we only need to use the 'edit' tab at the top.  All the changes are shown under the history tab.

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki5.jpg

Copy the text from the white text box to an editor of choice.  I suggest Notepad++ with the Aspell dictionary plugin installed. The text isn't formatted in this example which is why I chose it.  The information you are going to recieve from the decoders is going to be formatted in a simular way.  The first time I tried to edit a record I chose to just cut and paste from other records to start with and then start making changes.

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki9.jpg

Save the information to a txt file in the USEPWiki folder for our SVN.  Chose the name of the record, followed by Def.   For the above example I called it MISCDef.txt.

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki6.jpg

I chose to cut and paste the formatting from the DOOR record for now but I need to make changes.

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki7.jpg

After you make corrections to the fields should start to reflect the values of the actual record you are submiting to the wiki.  In this case I am editing the MISC record.

https://skyrim-plugin-decoding-project.googlecode.com/svn/wiki/wikipics/USEPWiki8.jpg

When you are done you can priview your changes before subbmitting them.


The last thing to do is cut and paste the text you   

==Groups==

GRUPs are collections of [[#Records|records]], and are used to improve scanning of files to make it easier to skip over records that the reading program is not interested in. In addition to this, subgroups for WRLD and CELLS provide some useful structural information (e.g., the division of cell data into persistent and non-persistent references.)

===File Format===

{| class="wikitable" width="100%" 
! width="20%" | Name
! width="20%" | [[Tes5Mod:File Format Conventions|Type/Size]]
! width="60%" | Info
|-
| type
| char[4]
| Always "GRUP"
|-
| groupSize
| uint32
| Size of the entire group, ''including'' the group header (24 bytes).
* This is in contrast to [[#Records|records]] and [[#Fields|fields]], whose sizes does ''not'' include their header sizes.
|-
| label
| uint8[4]
| Format depends on group type.
|-
| groupType
| int32
| Group type...
  {| class="wikitable" width="100%" 
  ! | Type
  ! | Info
  ! | Label 
  ! | Label 
  |-
  | 0 || Top (Type) || char[4] || Record type
  |-
  | 1 || World Children || formid || Parent
  |-
  | 2 || Interior Cell Block || long|| Block number
  |-
  | 3 || Interior Cell Sub-Block || long || Sub-block number
  |-
  | 4 || Exterior Cell Block || short[2] || Grid Y, X (Note the reverse order)
  |-
  | 5 || Exterior Cell Sub-Block || short[2] || Grid Y, X (Note the reverse order)
  |-
  | 6 || Cell Children || formid || Parent
  |-
  | 7 || Topic Children || formid || Parent
  |-
  | 8 || Cell Persistent Childen || formid || Parent
  |-
  | 9 || Cell Temporary Children || formid || Parent
  |-
  | 10 || Cell Visible Distant Children || formid || Parent
  |}

|-
| stamp
| uint16
| Date stamp, presumably of the last file modification. Low byte = day; high byte = number of months since December 2002 (i.e., 1 = January 2003).
|-
| unknown
| uint16
| 
|-
| version
| uint16
| 
|-
| unknown
| uint16
| 
|-
| data
| uint8[groupSize]
| Records and subgroups.
|}

===Top Groups===

In Skyrim.esm, the top, or highest level groups are stored in the following order:

:GMST, KYWD, LCRT, AACT, TXST, GLOB, CLAS, FACT, HDPT, HAIR, EYES, RACE, SOUN, ASPC, MGEF, SCPT, LTEX, ENCH, SPEL, SCRL, ACTI, TACT, ARMO, BOOK, CONT, DOOR, INGR, LIGH, MISC, APPA, STAT, SCOL, MSTT, PWAT, GRAS,  TREE, CLDC, FLOR, FURN, WEAP, AMMO, NPC_, LVLN, KEYM, ALCH, IDLM, COBJ, PROJ, HAZD, SLGM, LVLI, WTHR, CLMT, SPGD, RFCT, REGN, NAVI, CELL, WRLD, DIAL, QUST, IDLE, PACK, CSTY, LSCR, LVSP, ANIO, WATR, EFSH, EXPL,  DEBR, IMGS, IMAD, FLST, PERK, BPTD, ADDN, AVIF, CAMS, CPTH, VTYP, MATT, IPCT, IPDS, ARMA, ECZN, LCTN, MESG, RGDL, DOBJ, LGTM, MUSC, FSTP, FSTS, SMBN, SMQN, SMEN, DLBR, MUST, DLVW, WOOP, SHOU, EQUP, RELA, SCEN, ASTP, OTFT, ARTO, MATO, MOVT, ''HAZD'', SNDR, DUAL, SNCT, SOPM, COLL, CLFM, REVB

Whether the game engine expects this order is unknown, but it's probably safer to use this order than not.

All top groups contain records matching their label (e.g., the GMST top group contains GMST records). For most top groups, ''only'' the matching record types are present. However, in the CELL, WRLD and DIAL top groups, each main record can be followed by one or more child groups which contain additional records of a different type. Unlike Oblivion, WRLD groups in Skyrim no longer contain ROAD records.

The following groups are only found in subgroups of other records:
:REFR, ACHR, NAVM, PGRE, PHZD, LAND, INFO

Notes:
*6 record types have a GRUP but have no records:[[Tes5Mod:Mod File Format/CLDC|CLDC]], [[Tes5Mod:Mod File Format/HAIR|HAIR]], RGDL, SCPT, SCOL, PWAT.  
*There are 2 HAZD groups, the second one has no records.

==Records==

{| class="wikitable" width="100%" 
! width="20%" | Name
! width="20%" | [[Tes5Mod:File Format Conventions|Type/Size]]
! width="60%" | Info
|-
| type || char[4] || Type
|-
| dataSize || uint32 || Size of data field.
|-
| flags || uint32 || Flags...
{| class="wikitable" width="100%" 
! | Flag
! | Meaning
|-
| 0x00000001 || ''(TES4 record only)'' Master (ESM) file.
|-
| 0x00000020 || Deleted
|-
| 0x00000040 || Related to shields
|-
| 0x00000080 || ''(TES4 record only)'' Is localized. This will make Skyrim load the .STRINGS, .DLSTRINGS, and .ILSTRINGS files associated with the mod. If this flag is not set, lstrings are treated as zstrings.
|-
| 0x00000200 || ''(REFR Record)'' Hidden From Local Map<br>''(ACHR Record)'' Starts Dead
|-
| 0x00000400 || Quest item / Persistent reference<br>''(LSCR Record)'' Displays in Main Menu
|-
| 0x00000800 || Initially disabled
|-
| 0x00001000 || Ignored
|-
| 0x00008000 || Visible when distant
|-
| 0x00020000 || Dangerous / Off limits (Interior cell)
|-
| 0x00040000 || Data is compressed
|-
| 0x00080000 || Can't wait
|}

|-
| id || uint32 || Record (form) identifier.
* TES4 and GRUP (group) records have FormIds of 0.
|-
| revision || uint32 || Used for revision control by the CS (only if enabled)
* Probably the same format as Oblivion's
|-
| version || uint16 || 
|-
| unknown || uint16 || unknown
|-
| data || uint8[dataSize] || Data
* For uncompressed records, this is a sequence of fields. 
* Compressed data is the same, except that the fields are compressed using [http://zlib.net ZLIB], and stored into the data field like so...
{| class="wikitable" width="100%" 
! | Name
! | [[Tes5Mod:File Format Conventions|Type/Size]]
! | Info
|-
| decompSize || uint32 || Size of decompressed data.
|-
| compData || uint8[dataSize-4] || Compressed collection of fields.
|}

|}

==Fields==

{| class="wikitable" width="100%" 
! width="20%" | Name
! width="20%" | [[Tes5Mod:File Format Conventions|Type/Size]]
! width="60%" | Info
|-
| type || char[4] || Field type.
|-
| dataSize || uint16 || Size of data field. <sup>†</sup>
|-
| data|| uint8[dataSize] || Data.
* Format depends on record and field type.
|}

<sup>†</sup>If the preceding field has the type XXXX, then dataSize will be 0 and the size of the data is in fact the 32 bit quantity stored in the XXXX field.